# üìñ –ü–æ—è—Å–Ω–µ–Ω–Ω—è –¥–ª—è –ø—ñ–¥–æ–ø—ñ—á–Ω–æ–≥–æ: –Ø–∫ –ø—Ä–∞—Ü—é—î Duck Sorter Game

## üéØ –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–¥–µ—è

–ì—Ä–∞ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó **–∞–≤—Ç–æ–Ω–æ–º–Ω–∏—Ö –∞–≥–µ–Ω—Ç—ñ–≤** ‚Äî –∫–æ–∂–Ω–∞ —Ç–æ—á–∫–∞ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ –ø—Ä–∏–π–º–∞—î —Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ —Å–≤—ñ–π —Ä—É—Ö, —Ä–µ–∞–≥—É—é—á–∏ –Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è. –ù–µ–º–∞—î —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞, —è–∫–∏–π –±–∏ –∫–∞–∑–∞–≤ —Ç–æ—á–∫–∞–º –∫—É–¥–∏ —Ä—É—Ö–∞—Ç–∏—Å—è. –í—Å—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –≤–∏–Ω–∏–∫–∞—î –∑ –ø—Ä–æ—Å—Ç–∏—Ö –ª–æ–∫–∞–ª—å–Ω–∏—Ö –ø—Ä–∞–≤–∏–ª.

## üßÆ –í–µ–∫—Ç–æ—Ä–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (Vector2D)

### –©–æ —Ç–∞–∫–µ –≤–µ–∫—Ç–æ—Ä?

–í–µ–∫—Ç–æ—Ä ‚Äî —Ü–µ –Ω–∞–ø—Ä—è–º–æ–∫ —ñ –≤–µ–ª–∏—á–∏–Ω–∞. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:

- –ü–æ–∑–∏—Ü—ñ—è –Ω–∞ –µ–∫—Ä–∞–Ω—ñ: `(x: 100, y: 200)`
- –®–≤–∏–¥–∫—ñ—Å—Ç—å: `(x: 2, y: -1)` ‚Äî —Ä—É—Ö–∞—î—Ç—å—Å—è –Ω–∞ 2 –ø—ñ–∫—Å–µ–ª—ñ –≤–ø—Ä–∞–≤–æ —ñ 1 –ø—ñ–∫—Å–µ–ª—å –≤–≥–æ—Ä—É

### –û—Å–Ω–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó

```typescript
// –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤–µ–∫—Ç–æ—Ä—ñ–≤ (–ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è)
position.add(velocity); // –Ω–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è = —Å—Ç–∞—Ä–∞ –ø–æ–∑–∏—Ü—ñ—è + —à–≤–∏–¥–∫—ñ—Å—Ç—å

// –í—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è –≤–µ–∫—Ç–æ—Ä—ñ–≤ (–Ω–∞–ø—Ä—è–º–æ–∫ –¥–æ —Ü—ñ–ª—ñ)
desired = target.sub(position); // –Ω–∞–ø—Ä—è–º–æ–∫ –≤—ñ–¥ –ø–æ–∑–∏—Ü—ñ—ó –¥–æ —Ü—ñ–ª—ñ

// –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è (–æ–¥–∏–Ω–∏—á–Ω–∏–π –≤–µ–∫—Ç–æ—Ä –¥–æ–≤–∂–∏–Ω–∏ 1)
desired.normalize(); // –∑–±–µ—Ä—ñ–≥–∞—î —Ç—ñ–ª—å–∫–∏ –Ω–∞–ø—Ä—è–º–æ–∫

// –ú–Ω–æ–∂–µ–Ω–Ω—è –Ω–∞ —á–∏—Å–ª–æ (–∑–±—ñ–ª—å—à–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ)
desired.mult(maxSpeed); // –Ω–∞–ø—Ä—è–º–æ–∫ * –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å
```

## üéÆ –§—ñ–∑–∏–∫–∞ —Ä—É—Ö—É

–ö–æ–∂–Ω–∞ —Ç–æ—á–∫–∞ –º–∞—î —Ç—Ä–∏ –≤–µ–∫—Ç–æ—Ä–∏:

1. **Position** ‚Äî –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è
2. **Velocity** ‚Äî —è–∫ —à–≤–∏–¥–∫–æ —ñ –≤ —è–∫–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É —Ä—É—Ö–∞—î—Ç—å—Å—è
3. **Acceleration** ‚Äî —è–∫ –∑–º—ñ–Ω—é—î—Ç—å—Å—è —à–≤–∏–¥–∫—ñ—Å—Ç—å (—Å–∏–ª–∏)

### –¶–∏–∫–ª –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:

```typescript
update() {
  velocity.add(acceleration)      // —à–≤–∏–¥–∫—ñ—Å—Ç—å –∑–º—ñ–Ω—é—î—Ç—å—Å—è –≤—ñ–¥ —Å–∏–ª
  velocity.limit(maxSpeed)        // –Ω–µ –¥–æ–∑–≤–æ–ª—è—î–º–æ —Ä—É—Ö–∞—Ç–∏—Å—è –Ω–∞–¥—Ç–æ —à–≤–∏–¥–∫–æ
  position.add(velocity)          // –ø–æ–∑–∏—Ü—ñ—è –∑–º—ñ–Ω—é—î—Ç—å—Å—è –≤—ñ–¥ —à–≤–∏–¥–∫–æ—Å—Ç—ñ
  acceleration.mult(0)            // —Å–∫–∏–¥–∞—î–º–æ —Å–∏–ª–∏ (–æ–±–Ω—É–ª—è—î–º–æ –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è)
}
```

## üß≠ Steering Behaviors (–ü–æ–≤–µ–¥—ñ–Ω–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è)

### 1. Flee (–í—Ç–µ—á–∞ –≤—ñ–¥ –∫—É—Ä—Å–æ—Ä–∞)

```typescript
flee(target) {
  // –ö—Ä–æ–∫ 1: –í–∏–∑–Ω–∞—á–∏—Ç–∏ –Ω–∞–ø—Ä—è–º–æ–∫ –í–Ü–î —Ü—ñ–ª—ñ
  desired = position - target  // –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ –¥–æ seek

  // –ö—Ä–æ–∫ 2: –ß–∏–º –±–ª–∏–∂—á–µ —Ü—ñ–ª—å, —Ç–∏–º —Å–∏–ª—å–Ω—ñ—à–∞ —Å–∏–ª–∞
  distance = desired.mag()
  strength = (fleeRadius - distance) / fleeRadius

  // –ö—Ä–æ–∫ 3: –ë–∞–∂–∞–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å –≤ —Ü—å–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É
  desired.normalize()
  desired.mult(maxSpeed * strength)

  // –ö—Ä–æ–∫ 4: –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫–µ—Ä—É—é—á—É —Å–∏–ª—É
  steering = desired - velocity

  return steering
}
```

**–ü—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏**: "–Ø–∫—â–æ –∫—É—Ä—Å–æ—Ä –±–ª–∏–∑—å–∫–æ, —Ç—ñ–∫–∞–π —É –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É!"

### 2. Cohesion (–ó–≥—É—Ä—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å ‚Äî —Ç—è–≥–Ω–µ–Ω–Ω—è –¥–æ —Å–≤–æ—ó—Ö)

```typescript
cohesion(ducks) {
  // –ö—Ä–æ–∫ 1: –ó–Ω–∞–π—Ç–∏ –≤—Å—ñ—Ö —Å—É—Å—ñ–¥—ñ–≤ –°–í–û–ì–û –∫–æ–ª—å–æ—Ä—É
  let center = Vector.zero()
  let count = 0

  for (duck of ducks) {
    if (duck.color === this.color && duck.dist < cohesionRadius) {
      center.add(duck.position)  // –¥–æ–¥–∞—Ç–∏ –ø–æ–∑–∏—Ü—ñ—é —Å—É—Å—ñ–¥–∞
      count++
    }
  }

  // –ö—Ä–æ–∫ 2: –û–±—á–∏—Å–ª–∏—Ç–∏ —Ü–µ–Ω—Ç—Ä –≥—Ä—É–ø–∏
  center.div(count)  // —Å–µ—Ä–µ–¥–Ω—è –ø–æ–∑–∏—Ü—ñ—è

  // –ö—Ä–æ–∫ 3: –†—É—Ö–∞—Ç–∏—Å—è –¥–æ —Ü–µ–Ω—Ç—Ä—É
  return seek(center)
}
```

**–ü—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏**: "–ó–Ω–∞–π–¥–∏ —Å–µ—Ä–µ–¥–Ω—é –ø–æ–∑–∏—Ü—ñ—é —Ç–≤–æ—ó—Ö –∫–æ–ª—å–æ—Ä–æ–≤–∏—Ö —Å—É—Å—ñ–¥—ñ–≤ —ñ —Ä—É—Ö–∞–π—Å—è –¥–æ –Ω–µ—ó"

### 3. Separation (–í—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω–Ω—è ‚Äî –Ω–µ –∑–ª–∏–≤–∞—Ç–∏—Å—è)

```typescript
separation(ducks) {
  let steer = Vector.zero()

  for (duck of ducks) {
    distance = this.position.dist(duck.position)

    if (distance < separationRadius) {
      // –°–∏–ª–∞ –≤—ñ–¥—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω–∞ –¥–æ –±–ª–∏–∑—å–∫–æ—Å—Ç—ñ
      diff = this.position - duck.position
      diff.normalize()
      diff.div(distance)  // —á–∏–º –±–ª–∏–∂—á–µ, —Ç–∏–º —Å–∏–ª—å–Ω—ñ—à–µ
      steer.add(diff)
    }
  }

  return steer
}
```

**–ü—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏**: "–Ø–∫—â–æ —Ö—Ç–æ—Å—å –∑–∞–Ω–∞–¥—Ç–æ –±–ª–∏–∑—å–∫–æ, –≤—ñ–¥—Å—É–Ω—å—Å—è –≤—ñ–¥ –Ω—å–æ–≥–æ"

### 4. Align (–í–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è ‚Äî —Ä—É—Ö —É –æ–¥–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É)

```typescript
align(ducks) {
  let avgVelocity = Vector.zero()
  let count = 0

  for (duck of ducks) {
    if (duck.color === this.color && duck.dist < alignRadius) {
      avgVelocity.add(duck.velocity)  // –¥–æ–¥–∞—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å —Å—É—Å—ñ–¥–∞
      count++
    }
  }

  // –°–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å –≥—Ä—É–ø–∏
  avgVelocity.div(count)

  // –ù–∞–º–∞–≥–∞—Ç–∏—Å—è —Ä—É—Ö–∞—Ç–∏—Å—è —Ç–∞–∫ —Å–∞–º–æ
  return avgVelocity - this.velocity
}
```

**–ü—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏**: "–ü–æ–¥–∏–≤–∏—Å—å —è–∫ —Ä—É—Ö–∞—é—Ç—å—Å—è —Ç–≤–æ—ó —Å—É—Å—ñ–¥–∏ —ñ —Ä—É—Ö–∞–π—Å—è —Ç–∞–∫ —Å–∞–º–æ"

## üé≤ –ö–æ–º–±—ñ–Ω—É–≤–∞–Ω–Ω—è —Å–∏–ª

–£ –∫–æ–∂–Ω–æ–º—É –∫–∞–¥—Ä—ñ –≥—Ä–∏ —Ç–æ—á–∫–∞:

1. –†–æ–∑—Ä–∞—Ö–æ–≤—É—î –í–°–Ü —Å–∏–ª–∏ (flee, cohesion, separation, align)
2. –ó–∞—Å—Ç–æ—Å–æ–≤—É—î –≤–∞–≥–∏ –¥–æ –∫–æ–∂–Ω–æ—ó —Å–∏–ª–∏
3. –î–æ–¥–∞—î —ó—Ö —Ä–∞–∑–æ–º –¥–æ `acceleration`
4. –û–Ω–æ–≤–ª—é—î –ø–æ–∑–∏—Ü—ñ—é

```typescript
gameLoop() {
  for (duck of ducks) {
    // –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—Å—ñ —Å–∏–ª–∏
    let flee = duck.flee(mouse) * FLEE_WEIGHT
    let cohesion = duck.cohesion(ducks) * COHESION_WEIGHT
    let separation = duck.separation(ducks) * SEPARATION_WEIGHT
    let align = duck.align(ducks) * ALIGN_WEIGHT

    // –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –¥–æ —Ç–æ—á–∫–∏
    duck.applyForce(flee)
    duck.applyForce(cohesion)
    duck.applyForce(separation)
    duck.applyForce(align)

    // –û–Ω–æ–≤–∏—Ç–∏ –ø–æ–∑–∏—Ü—ñ—é
    duck.update()
  }
}
```

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–º–æ–≥–∏

```typescript
checkWin() {
  // –ó–≥—Ä—É–ø—É–≤–∞—Ç–∏ —Ç–æ—á–∫–∏ –∑–∞ –∫–æ–ª—å–æ—Ä–∞–º–∏
  groups = groupByColor(ducks)

  // –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ–ª—å–æ—Ä—É
  for (group of groups) {
    // –ó–Ω–∞–π—Ç–∏ —Ü–µ–Ω—Ç—Ä –≥—Ä—É–ø–∏
    center = calculateCenter(group)

    // –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –≤—Å—ñ —Ç–æ—á–∫–∏ –±–ª–∏–∑—å–∫–æ
    for (duck of group) {
      if (duck.dist(center) > GROUP_RADIUS) {
        return false  // —Ö–æ—á–∞ –± –æ–¥–Ω–∞ –¥–∞–ª–µ–∫–æ
      }
    }
  }

  return true  // –≤—Å—ñ –≥—Ä—É–ø–∏ –∑—ñ–±—Ä–∞–Ω—ñ!
}
```

## üé® Canvas —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

```typescript
draw() {
  // 1. –û—á–∏—Å—Ç–∏—Ç–∏ canvas
  ctx.fillRect(0, 0, width, height)

  // 2. –ù–∞–º–∞–ª—é–≤–∞—Ç–∏ –∫–æ–∂–Ω—É —Ç–æ—á–∫—É
  for (duck of ducks) {
    ctx.fillStyle = duck.color
    ctx.beginPath()
    ctx.arc(duck.x, duck.y, duck.radius, 0, Math.PI * 2)
    ctx.fill()
  }
}
```

## üí° –ü–æ—Ä–∞–¥–∏ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –Ø–∫—â–æ —Ç–æ—á–∫–∏ –∑–∞–Ω–∞–¥—Ç–æ —à–≤–∏–¥–∫–æ —Ä–æ–∑–ª—ñ—Ç–∞—é—Ç—å—Å—è:

- –ó–±—ñ–ª—å—à `COHESION_WEIGHT` (—Å–∏–ª—å–Ω—ñ—à–µ —Ç—è–≥–Ω–µ–Ω–Ω—è –¥–æ —Å–≤–æ—ó—Ö)
- –ó–º–µ–Ω—à `FLEE_WEIGHT` (—Å–ª–∞–±—à–∞ –≤—Ç–µ—á–∞ –≤—ñ–¥ –∫—É—Ä—Å–æ—Ä–∞)

### –Ø–∫—â–æ —Ç–æ—á–∫–∏ –∑–ª–∏–≤–∞—é—Ç—å—Å—è –≤ –æ–¥–Ω—É:

- –ó–±—ñ–ª—å—à `SEPARATION_WEIGHT` (—Å–∏–ª—å–Ω—ñ—à–µ –≤—ñ–¥—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è)
- –ó–±—ñ–ª—å—à `SEPARATION_RADIUS` (–±—ñ–ª—å—à–∞ –¥–∏—Å—Ç–∞–Ω—Ü—ñ—è –≤—ñ–¥—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è)

### –Ø–∫—â–æ –≤–∞–∂–∫–æ –∑—ñ–±—Ä–∞—Ç–∏ –≥—Ä—É–ø–∏:

- –ó–º–µ–Ω—à `GROUP_RADIUS` (–º–µ–Ω—à–∏–π —Ä–∞–¥—ñ—É—Å –¥–ª—è –ø–µ—Ä–µ–º–æ–≥–∏)
- –ó–±—ñ–ª—å—à `COHESION_RADIUS` (—Ç–æ—á–∫–∏ –±–∞—á–∞—Ç—å —Å–≤–æ—ó—Ö –∑–¥–∞–ª–µ–∫—É)

## üöÄ –©–æ –º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏?

1. **–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –∫—É—Ä—Å–æ—Ä–∞** ‚Äî –ø–æ–∫–∞–∑–∞—Ç–∏ —Ä–∞–¥—ñ—É—Å –≤–ø–ª–∏–≤—É –Ω–∞–≤–∫–æ–ª–æ –º–∏—à—ñ
2. **–ó–≤—É–∫–∏** ‚Äî –¥–æ–¥–∞—Ç–∏ –∑–≤—É–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏
3. **Particles** ‚Äî –µ—Ñ–µ–∫—Ç sparkle –∫–æ–ª–∏ –≥—Ä—É–ø–∞ –∑—ñ–±—Ä–∞–Ω–∞
4. **–°–∫–ª–∞–¥–Ω—ñ—à—ñ —Ä—ñ–≤–Ω—ñ** ‚Äî –±—ñ–ª—å—à–µ –∫–æ–ª—å–æ—Ä—ñ–≤, –ø–µ—Ä–µ—à–∫–æ–¥–∏ –Ω–∞ –∫–∞—Ä—Ç—ñ
5. **Leaderboard** ‚Äî –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∫—Ä–∞—â—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤ localStorage
6. **Customization** ‚Äî –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –≥—Ä–∞–≤—Ü—é –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –≤–∞–≥–∏ behaviors

## üìö –†–µ—Å—É—Ä—Å–∏ –¥–ª—è –ø–æ–≥–ª–∏–±–ª–µ–Ω–æ–≥–æ –≤–∏–≤—á–µ–Ω–Ω—è

- [The Nature of Code - Chapter 5](https://natureofcode.com/autonomous-agents/)
- [Craig Reynolds - Steering Behaviors](https://www.red3d.com/cwr/steer/)
- [Flocking Algorithm](<https://en.wikipedia.org/wiki/Flocking_(behavior)>)

---

–£—Å–ø—ñ—Ö—ñ–≤ –∑ –ø—Ä–æ—î–∫—Ç–æ–º! üéâ
